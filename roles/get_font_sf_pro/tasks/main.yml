---
- name: Ensure font directory exists
  ansible.builtin.file:
    path: "{{ get_font_sf_pro_font_path }}/src"
    state: directory
    mode: "0775"
    owner: 1000

- name: Download and unzip
  ansible.builtin.unarchive:
    src: "https://devimages-cdn.apple.com/design/resources/download/SF-Pro.dmg"
    dest: "{{ get_font_sf_pro_font_path }}/src"
    remote_src: true

- name: Unzip DMG file
  ansible.builtin.unarchive:
    src: "{{ get_font_sf_pro_font_path }}/src/SF-Pro.dmg"
    dest: "{{ get_font_sf_pro_font_path }}/src"

- name: Unzip Payload
  ansible.builtin.unarchive:
    src: "{{ get_font_sf_pro_font_path }}/src/SFProFonts/Payload~"
    dest: "{{ get_font_sf_pro_font_path }}/src"

- name: Copy fonts
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "{{ get_font_sf_pro_font_path }}"
    mode: "0644"
    owner: 1000
  with_fileglob:
    - "{{ get_font_sf_pro_font_path }}/src/SFProFonts/Library/Fonts/*.otf"
